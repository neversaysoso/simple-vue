{"version":3,"file":"vue.js","sources":["../../src/utils/index.js","../../src/observer/array.js","../../src/observer/dep.js","../../src/observer/watcher.js","../../src/observer/index.js","../../src/state.js","../../src/compiler/index.js","../../src/init.js","../../src/index.js"],"sourcesContent":["export function isObject(data) {\r\n  return typeof data === 'object' && data !== null\r\n}\r\n\r\nexport function def(data, key, value) {\r\n  Object.defineProperty(data, key, {\r\n    enumerable: false,\r\n    configurable: false,\r\n    value\r\n  })\r\n}","let oldarrayMethods = Array.prototype\r\n\r\nexport const arrayMethods = Object.create(oldarrayMethods)\r\n\r\nconst methods = [\r\n  'push',\r\n  'shift',\r\n  'unshift',\r\n  'pop',\r\n  'sort',\r\n  'splice',\r\n  'reverse'\r\n]\r\n\r\nmethods.forEach(method => {\r\n  arrayMethods[method] = function (...args) {\r\n    const result = oldarrayMethods[method].apply(this, args)\r\n    let ob = this.__ob__\r\n    let inserted\r\n    switch (method) {\r\n      case 'push':\r\n      case 'unshift':\r\n        inserted = args\r\n        break;\r\n      case 'splice':\r\n        inserted = args.slice(2)\r\n      default:\r\n        break;\r\n    }\r\n\r\n    if (inserted) ob.observeArray(inserted)\r\n\r\n    return result\r\n  }\r\n});","export default class Dep { // 依赖收集\r\n  constructor() {\r\n    this.deps = [] // 存放watcher 一个watcher对应一个属性\r\n  }\r\n\r\n  addDep(dep) {\r\n    this.deps.push(dep)\r\n  }\r\n\r\n  notify() {\r\n    this.deps.forEach(dep => {\r\n      dep.update()\r\n    })\r\n  }\r\n}","import Dep from './dep'\r\n\r\nexport default class Watcher { // 执行更新\r\n  constructor() {\r\n    Dep.target = this\r\n  }\r\n  update() {\r\n    console.log('属性在watcher更新了')\r\n  }\r\n}","import {\r\n  isObject,\r\n  def\r\n} from '../utils/index'\r\n\r\nimport {\r\n  arrayMethods\r\n} from './array'\r\n\r\nimport Dep from './dep'\r\n\r\nimport Watcher from './watcher'\r\n\r\nclass Observer {\r\n  constructor(value) {\r\n    def(value, '__ob__', this)\r\n    if (Array.isArray(value)) {\r\n      value.__proto__ = arrayMethods\r\n      this.observeArray(value)\r\n    } else {\r\n      this.walk(value)\r\n    }\r\n    new Watcher()\r\n  }\r\n\r\n  walk(data) {\r\n    Object.keys(data).forEach(key => {\r\n      defineReactive(data, key, data[key])\r\n    })\r\n  }\r\n\r\n  observeArray(value) {\r\n    value.forEach(v => {\r\n      observe(v)\r\n    })\r\n  }\r\n}\r\n\r\nexport function defineReactive(data, key, value) {\r\n  observe(value) // 递归实现深度检测\r\n  const dep = new Dep()\r\n  Object.defineProperty(data, key, {\r\n    set(newVal) { // 观察者\r\n      if (newVal == value) return\r\n      observe(value) // 如果更新了一个对象 则继续检测\r\n      value = newVal\r\n      dep.notify()\r\n    },\r\n    get() {\r\n      Dep.target && dep.addDep(Dep.target)\r\n      return value\r\n    }\r\n  })\r\n}\r\n\r\nexport function observe(data) {\r\n  let isObj = isObject(data)\r\n  if (!isObj) {\r\n    return\r\n  }\r\n  return new Observer(data)\r\n}","import {\r\n  observe\r\n} from './observer/index'\r\n\r\nimport Dep from './observer/dep'\r\n\r\nimport Watcher from './observer/watcher'\r\n\r\nexport function initState(vm) {\r\n  const opts = vm.$options\r\n  // if (opts.props) {\r\n  //   initProps(vm)\r\n  // }\r\n\r\n  // if (opts.methods) {\r\n  //   initMethod(vm)\r\n  // }\r\n\r\n  if (opts.data) {\r\n    initData(vm)\r\n  }\r\n\r\n  // if (opts.computed) {\r\n  //   initComputed(vm)\r\n  // }\r\n\r\n  // if (opts.watch) {\r\n  //   initWatch(vm)\r\n  // }\r\n}\r\n\r\nfunction initProps() {}\r\n\r\nfunction initMethod() {}\r\n\r\nfunction initData(vm) {\r\n  let data = vm.$options.data\r\n  data = vm._data = typeof data === 'function' ? data.call(vm) : data\r\n  observe(data)\r\n}\r\n\r\nfunction initComputed() {}\r\n\r\nfunction initWatch() {}","export class Compile {\r\n  constructor(el, vm) {\r\n    this.$el = document.querySelector(el)\r\n    this.$vm = vm\r\n\r\n    if (this.$el) {\r\n      this.$fragment = this.node2Fragment(this.$el)\r\n      this.compile(this.$fragment)\r\n      this.$el.appendChild(this.$fragment)\r\n    }\r\n  }\r\n\r\n  node2Fragment(el) {\r\n    const frag = document.createDocumentFragment()\r\n    let child\r\n    while (child = el.firstChild) {\r\n      frag.appendChild(child)\r\n    }\r\n    return frag\r\n  }\r\n\r\n  compile(el) {\r\n    const childNodes = el.childNodes\r\n    Array.from(childNodes).forEach(node => {\r\n      if (this.isElement(node)) {\r\n        console.log('元素' + node.nodeName)\r\n      } else if (this.isInterpolation(node)) {\r\n        console.log('文本' + node.textContent)\r\n      }\r\n      if (node.childNodes && node.childNodes.length > 0) {\r\n        this.compile(node)\r\n      }\r\n    })\r\n  }\r\n\r\n  isElement(node) {\r\n    return node.nodeType === 1\r\n  }\r\n\r\n  isInterpolation(node) {\r\n    return node.nodeType === 3 && /\\{\\{(.*)\\}\\}/.test(node.textContent)\r\n  }\r\n}","import {\r\n  initState\r\n} from './state'\r\n\r\nimport {\r\n  Compile\r\n} from './compiler/index'\r\n\r\nexport function initMixin(Vue) {\r\n  Vue.prototype._init = function (options) {\r\n    const vm = this\r\n    vm.$options = options\r\n\r\n    initState(vm)\r\n\r\n    if (vm.$options.el) {\r\n      vm.$mount(vm.$options.el)\r\n    }\r\n  }\r\n  Vue.prototype.$mount = function (el) {\r\n    // const vm = this\r\n    // const options = vm.$options\r\n    // el = document.querySelector(el)\r\n\r\n    // if (!options.render) {\r\n    //   let template = options.template\r\n    //   if (!template && el) {\r\n    //     template = el.outerHTML\r\n    //   }\r\n\r\n    //   const render = compileToFunction(template)\r\n    //   options.render = render\r\n    // }\r\n    // options.render\r\n    new Compile(el, this)\r\n  }\r\n}","import {\r\n  initMixin\r\n} from './init'\r\n\r\nclass Vue {\r\n  constructor(options) {\r\n    this._init(options)\r\n  }\r\n}\r\n\r\ninitMixin(Vue)\r\n\r\nexport default Vue"],"names":["isObject","data","def","key","value","Object","defineProperty","enumerable","configurable","oldarrayMethods","Array","prototype","arrayMethods","create","methods","forEach","method","args","result","apply","ob","__ob__","inserted","slice","observeArray","Dep","deps","dep","push","update","Watcher","target","console","log","Observer","isArray","__proto__","walk","keys","defineReactive","v","observe","set","newVal","notify","get","addDep","isObj","initState","vm","opts","$options","initData","_data","call","Compile","el","$el","document","querySelector","$vm","$fragment","node2Fragment","compile","appendChild","frag","createDocumentFragment","child","firstChild","childNodes","from","node","isElement","nodeName","isInterpolation","textContent","length","nodeType","test","initMixin","Vue","_init","options","$mount"],"mappings":"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"}